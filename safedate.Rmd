---
title: "COVID19SafeDate"
author: "Dr Saiful Safuan Md Sani"
date: "`r Sys.Date()`"
runtime: shiny
---
```{r}
library(shiny)
library(shinythemes)

## Formula:
uppersafe <- function(index_exposed, max_ip, max_si) {
    max_index_onset = index_exposed + max_ip
    maxsafe_date = max_index_onset + max_si
    
    return (maxsafe_date)
}


meansafe <- function(index_exposed, mean_ip, mean_si) {
    mean_index_onset = index_exposed + mean_ip
    meansafe_date = mean_index_onset + mean_si
    
    return (meansafe_date)
}   

ui <- navbarPage(theme = shinythemes::shinytheme("sandstone"),
                 #navbarPage(theme = "sandstone.css" -:if deploying
                 #theme = shinythemes::shinytheme("sandstone") -:if running locally
                 "COVID-19 Safe Date Calculator",
                 
                 #multigeom tab
                 tabPanel("Safe Date",
                          
                          sidebarLayout(
                              sidebarPanel(
                                  
                                  dateInput(
                                      inputId = "index_exposed",
                                      label = "Index Case Exposed Date:",
                                      value = "2020-05-10"
                                  ),
                                  
                                  numericInput(
                                      inputId = "max_ip",
                                      label = "Maximum Incubation Period (days):",
                                      value = 14,
                                      step = 1
                                  ),
                                  
                                  numericInput(
                                      inputId = "max_si",
                                      label = "Maximum Serial Interval (days):",
                                      value = 7,
                                      step  = 1
                                      
                                  ),
                                  
                                  numericInput(
                                      inputId = "mean_ip",
                                      label = "Mean Incubation Period (days):",
                                      value = 6,
                                      step = 1
                                  ),
                                  
                                  numericInput(
                                      inputId = "mean_si",
                                      label = "Mean Serial Interval (days):",
                                      value = 6,
                                      step  = 1
                                      
                                  )
                              ),
                              
                              mainPanel(
                                  
                                  helpText("This calculator assists in estimating the safe date for a person with 
                                       a possibility of contact with a COVID-19 positive person. 
                                       A safe date is the date after which COVID-19 is extremely unlikely."),
                                  
                                  helpText(em("Transmission scenarios: ",
                                              p(h6("Scenario 1: Symptomatic COVID+ with Person A, to estimate the safe date for person A (patient), 
                                            take IP = 0, SI = <keep or change values>")),
                                              p(h6("Scenario 2: Asymptomatic COVID+ with Person A, to estimate the safe date for person A (patient), 
                                            take IP = <keep or change values>, SI = <keep or change values>")),
                                              p(h6("Scenario 3: Symptomatic Person A who has close contact history with a COVID+ person 
                                       (symptom status unknown), with Person B, to estimate the safe date for person B (patient),
                                            take IP = 0, SI = <keep or change values>")),
                                              p(h6("Scenario 4: Asymptomatic Person A who has close contact history with a COVID+ person 
                                       (symptom status unknown), with Person B, to estimate the safe date for person B (patient),
                                            take IP = <keep or change values>, SI = <keep or change values>"))
                                  )
                                  ),
                                  #headerPanel(""),
                                  helpText("Default values of the model are based on these references:"),
                                  h5(
                                      uiOutput("ref1"),
                                      uiOutput("ref2"),
                                      uiOutput("ref3")
                                  ),
                                  #headerPanel(""),
                                  h6(
                                      uiOutput("input")
                                  ),
                                  h4(
                                      uiOutput("result")
                                  )
                              )
                          )
                 )
)

server <- function(input, output) {
  
    output$input <- renderText({
        paste0("Date index case exposed was ", "<strong>",input$index_exposed,
               " with maximum incubation period of ", input$max_ip,
               " and maximum serial interval of ", input$max_si, 
               ", or alternatively with mean incubation period of ", input$mean_ip,
               " and mean serial interval of ", input$mean_si,
               ",", "</strong>")
    })
    
    output$result <- renderText({
        uppersaf = uppersafe(index_exposed = input$index_exposed, 
                              max_ip = input$max_ip, 
                              max_si = input$max_si 
        )
        
        meansaf = meansafe(index_exposed = input$index_exposed, 
                            mean_ip = input$mean_ip, 
                            mean_si = input$mean_si 
        )
        
        paste0("Patient's maximum safe date is ",
               "<code>", round(uppersaf, 1), "</code>", ", and the mean safe date is ", "<code>", round(meansaf, 1), "</code>")
    })
    
    url1 <- a("1. Position Statement Singapore's NCID & Academy of Medicine", 
              href="https://www.ams.edu.sg/view-pdf.aspx?file=media%5C5556_fi_331.pdf&ofile=
              Period+of+Infectivity+Position+Statement+(final)+23-5-20+(logos).pdf")
    output$ref1 <- renderUI({
        tagList(url1)
    })
    
    url2 <- a("2. Incubation Period", href="https://www.acpjournals.org/doi/10.7326/M20-0504")
    output$ref2 <- renderUI({
        tagList(url2)
    })
    
    url3 <- a("3. Serial Interval", href="https://www.nature.com/articles/s41591-020-0869-5")
    output$ref3 <- renderUI({
        tagList(url3)
    })
}

# Run the application 
shinyApp(ui = ui, server = server)
```

